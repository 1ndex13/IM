{% extends "users/base.html" %}

{% block title %}Накладные прихода{% endblock %}

{% block content %}
<div>
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Накладные прихода</h2>
        <a href="{% url 'products:purchase_invoice_create' %}" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
            Создать накладную
        </a>
    </div>

    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <table class="min-w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Номер</th>
                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Поставщик</th>
                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата</th>
                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Статус</th>
                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Сумма</th>
                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Создал</th>
                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for invoice in invoices %}
                <tr class="hover:bg-gray-50 transition duration-150">
                    <td class="py-3 px-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">{{ invoice.invoice_number }}</div>
                    </td>
                    <td class="py-3 px-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">{{ invoice.supplier.name }}</div>
                    </td>
                    <td class="py-3 px-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">{{ invoice.invoice_date|date:"d.m.Y" }}</div>
                    </td>
                    <td class="py-3 px-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full 
                            {% if invoice.status == 'draft' %}bg-yellow-100 text-yellow-800
                            {% elif invoice.status == 'completed' %}bg-green-100 text-green-800
                            {% else %}bg-red-100 text-red-800{% endif %}">
                            {{ invoice.get_status_display }}
                        </span>
                    </td>
                    <td class="py-3 px-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">{{ invoice.total_amount }} ₽</div>
                    </td>
                    <td class="py-3 px-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">{{ invoice.created_by.get_full_name }}</div>
                    </td>
                    <td class="py-3 px-4 whitespace-nowrap">
                        <div class="flex space-x-2">
                            <a href="{% url 'products:purchase_invoice_detail' invoice.pk %}" 
                               class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                Просмотр
                            </a>
                            {% if invoice.status == 'draft' %}
                            <span class="text-gray-300">|</span>
                            <a href="{% url 'products:purchase_invoice_complete' invoice.pk %}" 
                               class="text-green-600 hover:text-green-800 text-sm font-medium"
                               onclick="return confirm('Завершить накладную? Остатки будут обновлены.')">
                                Завершить
                            </a>
                            <span class="text-gray-300">|</span>
                            <a href="{% url 'products:purchase_invoice_cancel' invoice.pk %}" 
                               class="text-red-600 hover:text-red-800 text-sm font-medium"
                               onclick="return confirm('Отменить накладную?')">
                                Отменить
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="py-8 px-4 text-center">
                        <div class="text-gray-500 text-lg">Накладные не найдены</div>
                        <a href="{% url 'products:purchase_invoice_create' %}" class="text-blue-600 hover:text-blue-800 mt-2 inline-block">
                            Создать первую накладную
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}